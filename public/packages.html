<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Packages - Travel</title>
  <link rel="stylesheet" href="style.css">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      overflow: hidden;
      height: 100vh;
      transition: background 1s ease;
      position: relative;
    }
    body::before {
      content: "";
      position: absolute; inset: 0;
      background: linear-gradient(-45deg, #5ddcff, #3c67e3, #4e00c2, #00c9ff);
      background-size: 400% 400%;
      animation: moveBg 12s ease infinite;
      z-index: 0;
    }
    @keyframes moveBg {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    body::after {
      content: "";
      position: absolute; inset: 0;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(12px);
      z-index: 1;
    }
    .crystal {
      position: absolute; pointer-events: none;
      width: 180px; height: 180px; border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.25) 0%, transparent 70%);
      filter: blur(60px);
      opacity: 0; transform: scale(0.6);
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 2;
    }
    body:hover .crystal { opacity: 1; transform: scale(1); }

    .slider {
      position: relative;
      width: 100%; height: 100vh;
      display: flex; overflow: hidden;
      align-items: center; justify-content: center;
      z-index: 3;
    }
    .slide {
      position: absolute;
      width: 90%; height: 80%;
      display: flex; align-items: center; justify-content: space-between;
      border-radius: 25px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(25px);
      border: 2px solid rgba(255, 255, 255, 0.25);
      box-shadow: 0 0 50px rgba(0, 255, 255, 0.35);
      opacity: 0; transform: translateX(100%) scale(0.98);
      transition: all 1.1s ease;
    }
    .slide.active {
      opacity: 1; transform: translateX(0) scale(1);
      box-shadow: 0 0 70px rgba(0, 255, 255, 0.5);
    }
    .text-section { flex: 1; padding: 60px; color: #fff; }
    .text-section h1 { font-size: 48px; margin-bottom: 20px; }
    .text-section p { font-size: 16px; line-height: 1.6; max-width: 500px; }
    .text-section button {
      margin-top: 30px;
      background: linear-gradient(90deg, #00eaff, #0072ff);
      color: #fff; border: none; padding: 14px 30px;
      border-radius: 40px; font-size: 16px; cursor: pointer;
    }
    .image-section { flex: 1; display: flex; justify-content: center; }
    .image-section img {
      width: 85%; height: auto; animation: float 4s ease-in-out infinite;
    }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    .nav-btn {
      position: absolute; top: 50%; transform: translateY(-50%);
      background: rgba(255,255,255,0.25);
      color: #fff; font-size: 26px;
      border: none; padding: 12px 18px; border-radius: 50%;
      cursor: pointer; z-index: 10;
    }
    .prev { left: 40px; }
    .next { right: 40px; }

    /* Search bar */
    .search-bar {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 30px;
      overflow: hidden;
      padding: 2px;
    }
    .search-bar input {
      background: transparent;
      border: none;
      color: white;
      outline: none;
      padding: 8px 12px;
    }
    .search-bar button {
      background: #00bfff;
      border: none;
      color: white;
      padding: 8px 14px;
      border-radius: 20px;
      cursor: pointer;
    }
    /* üì± Perfect Mobile Layout ‚Äî Image on Top, Then Title, Text & Button */
     @media (max-width: 768px) {
  .slide {
    flex-direction: column;
    height: auto;
    width: 95%;
    padding: 20px 0;
    margin: auto;
  }

  .image-section {
    order: -1;
    width: 100%;
    justify-content: center;
    margin-bottom: 20px;
  }

  .image-section img {
    width: 90%;
    max-width: 300px;
    height: auto;
  }

  .text-section {
    padding: 20px;
    text-align: center;
  }

  .text-section h1 {
    font-size: 28px;
  }

  .text-section p {
    font-size: 14px;
    max-width: 100%;
  }

  .text-section button {
    padding: 12px 24px;
    font-size: 14px;
  }

  .nav-btn {
    top: auto;
    bottom: 20px;
    transform: none;
    font-size: 22px;
    padding: 10px 14px;
  }

  .prev {
    left: 20px;
  }

  .next {
    right: 20px;
  }

  .slider {
    flex-direction: column;
    height: auto;
    padding-top: 100px;
    padding-bottom: 80px;
  }
}

  </style>
  <link rel="stylesheet" href="mobile.css">
</head>
<body>
  <div class="crystal" id="crystal"></div>

  <header style="z-index:4; position:absolute; width:100%;">
    <nav class="navbar">
      <div class="logo">Travelista Tours</div>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="packages.html" class="active">Packages</a></li>
        <li><a href="db.html">Dashboard</a></li>
        <li><a href="register.html">Register</a></li>
      </ul>

      <form class="search-bar" onsubmit="return handleSearch(event)">
        <input type="text" placeholder="Search destinations..." id="searchInput">
        <button type="submit">üîç</button>
      </form>
    </nav>
  </header>

  <div class="slider" id="slider"></div>
  <button class="nav-btn prev" onclick="prevSlide()">&#10094;</button>
  <button class="nav-btn next" onclick="nextSlide()">&#10095;</button>

  <script>
    const crystal = document.getElementById("crystal");
    document.addEventListener("mousemove", (e) => {
      crystal.style.left = e.pageX - 90 + "px";
      crystal.style.top = e.pageY - 90 + "px";
    });

    const slider = document.getElementById("slider");
    let current = 0;
    let slides = [];

    // Fetch packages
    fetch('http://localhost:5000/api/packages')
      .then(res => res.json())
      .then(data => {
        slides = data;
        renderSlides();
        showSlide(0);
      })
      .catch(err => {
        console.error("Failed to fetch packages:", err);
      });

    function renderSlides() {
      slider.innerHTML = slides.map(pkg => `
        <div class="slide">
          <div class="text-section">
            <h1>${pkg.title}</h1>
            <p>${pkg.highlights}</p>
            <p>${pkg.duration}</p>
            <p><b>üí∞ ‚Çπ${pkg.price}</b></p>
            <button onclick="bookNow(${pkg.id}, ${pkg.price})">Book Now</button>
          </div>
          <div class="image-section">
            <img src="images/${pkg.image1}" alt="${pkg.title}">
          </div>
        </div>
      `).join('');
    }

    function showSlide(i) {
      const allSlides = document.querySelectorAll('.slide');
      allSlides.forEach(s => s.classList.remove('active'));
      allSlides[i].classList.add('active');
      document.body.style.background = `linear-gradient(120deg, ${slides[i].color || "#00aaff"}, #000)`;
    }

    function nextSlide() { current = (current + 1) % slides.length; showSlide(current); }
    function prevSlide() { current = (current - 1 + slides.length) % slides.length; showSlide(current); }
    setInterval(nextSlide, 6000);

    // ‚úÖ Fixed Book Now
    async function bookNow(id, price) {
      try {
        const res = await fetch("http://localhost:5000/api/users/session", { credentials: "include" });
        const data = await res.json();

        if (!data.loggedIn) {
          alert('‚ö†Ô∏è Please login first!');
          window.location.href = 'login.html';
          return;
        }

        // Proceed to booking
        window.location.href = `booking.html?package_id=${id}&price=${price}`;
      } catch (err) {
        console.error("Error checking session:", err);
        alert("Something went wrong. Please try again.");
      }
    }

    // üîç Search feature
    function handleSearch(event) {
      event.preventDefault();
      const searchValue = document.getElementById('searchInput').value.toLowerCase();
      const matched = slides.filter(pkg => pkg.title.toLowerCase().includes(searchValue) || pkg.location?.toLowerCase().includes(searchValue));

      if (matched.length === 0) {
        alert("No packages found for your search!");
        return false;
      }

      slides = matched;
      current = 0;
      renderSlides();
      showSlide(0);
      return false;
    }
  </script>
</body>
</html>
